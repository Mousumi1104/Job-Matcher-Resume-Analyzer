{% extends "base.html" %}
{% load static %}
{% block content %}

<div class="max-w-7xl mx-auto py-8 px-4">
    <h2 class="text-2xl font-bold text-center text-blue-700 mb-6 flex items-center justify-center">
        <i class="bi bi-briefcase-fill mr-2"></i> Job Recommendations
    </h2>

    <!-- Tabs -->
    <div class="border-b border-gray-200 mb-6">
        <ul class="flex justify-center space-x-6 text-sm font-semibold text-gray-600">
            <li>
                <button id="all-jobs-tab" data-tab="all-jobs"
                    class="tab-btn text-blue-600 border-b-2 border-blue-600 pb-2">All Jobs</button>
            </li>
            <li>
                <button id="saved-jobs-tab" data-tab="saved-jobs" class="tab-btn pb-2 hover:text-blue-600">Saved
                    Jobs</button>
            </li>
        </ul>
    </div>

    <!-- ============ All Jobs ============ -->
    <div id="all-jobs" class="tab-content block">
        {% if match %}
        <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-6">
            {% for m in match %}
            <div class="bg-white shadow-md rounded-2xl p-5 hover:shadow-lg transition">
                <div class="flex justify-between items-start">
                    <div>
                        <a href="{% url 'job_details' m.job.id %}"
                            class="text-lg font-semibold text-gray-800 hover:text-blue-600">
                            {{ m.job.title }}
                        </a>
                        <p class="text-gray-600">{{ m.job.company }}</p>
                        <p class="text-gray-500 text-sm flex items-center mt-1">
                            <i class="bi bi-geo-alt text-red-500 mr-1"></i> {{ m.job.location|default:"N/A" }}
                        </p>
                    </div>

                    <!-- Match Score Circle -->
                    <div class="relative w-12 h-12">
                        <svg class="w-full h-full" viewBox="0 0 36 36">
                            <path class="text-gray-200" stroke-width="3" fill="none"
                                d="M18 2.0845a15.9155 15.9155 0 0 1 0 31.831a15.9155 15.9155 0 0 1 0 -31.831" />
                            <path
                                class="{% if m.match_score > 80 %}text-green-500{% elif m.match_score > 50 %}text-yellow-400{% else %}text-red-500{% endif %}"
                                stroke-width="3" stroke-linecap="round" fill="none"
                                stroke-dasharray="{{ m.match_score }},100"
                                d="M18 2.0845a15.9155 15.9155 0 0 1 0 31.831a15.9155 15.9155 0 0 1 0 -31.831" />
                        </svg>
                        <div class="absolute inset-0 flex items-center justify-center">
                            <span class="text-xs font-medium text-gray-700">{{ m.match_score|floatformat:1 }}%</span>
                        </div>
                    </div>
                </div>

                <!-- Resume -->
                <div class="mt-3 text-sm text-gray-600">
                    <a href="{% url 'resume_detail' m.resume_id %}" target="_blank"
                        class="flex items-center hover:text-blue-600">
                        <i class="bi bi-file-earmark-text mr-1"></i> {{ m.resume.file.name|slice:'15:' }}
                    </a>
                </div>

                <!-- Actions -->
                <div class="flex justify-between items-center mt-4">
                    <a href="{{ m.job.apply_url }}" target="_blank"
                        class="inline-flex items-center text-blue-600 hover:text-blue-800 text-sm font-semibold">
                        <i class="bi bi-box-arrow-up-right mr-1"></i> Apply
                    </a>
                    <div class="flex space-x-2">
                        {% if m.is_saved %}
                        <button class="bg-green-100 text-green-600 rounded-full p-2" title="Saved">
                            <i class="bi bi-bookmark-check-fill"></i>
                        </button>
                        {% else %}
                        <a href="{% url 'save_jobs' m.job.id m.resume_id %}"
                            class="border border-green-500 text-green-500 rounded-full p-2 hover:bg-green-50"
                            title="Save Job">
                            <i class="bi bi-bookmark-plus"></i>
                        </a>
                        {% endif %}
                        <a href="{% url 'dismiss_jobs' m.job.id m.resume_id %}"
                            class="border border-red-500 text-red-500 rounded-full p-2 hover:bg-red-50"
                            title="Dismiss Job">
                            <i class="bi bi-x-circle"></i>
                        </a>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
        {% else %}
        <div class="text-center bg-blue-50 text-blue-600 py-4 rounded-xl">
            <i class="bi bi-info-circle mr-2"></i>No job recommendations found.
        </div>
        {% endif %}
    </div>

    <!-- ============ Saved Jobs ============ -->
    <div id="saved-jobs" class="tab-content hidden">
        {% if match %}
        <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-6">
            {% for m in match %}
            {% if m.is_saved %}
            <div class="bg-white shadow-md rounded-2xl p-5 hover:shadow-lg transition">
                <div class="flex justify-between items-start">
                    <div>
                        <a href="{% url 'job_details' m.job_id %}"
                            class="text-lg font-semibold text-gray-800 hover:text-blue-600">
                            {{ m.job.title }}
                        </a>
                        <p class="text-gray-600">{{ m.job.company }}</p>
                        <p class="text-gray-500 text-sm flex items-center mt-1">
                            <i class="bi bi-geo-alt text-red-500 mr-1"></i> {{ m.job.location|default:"N/A" }}
                        </p>
                    </div>

                    <!-- Match Score -->
                    <div class="relative w-12 h-12">
                        <svg class="w-full h-full" viewBox="0 0 36 36">
                            <path class="text-gray-200" stroke-width="3" fill="none"
                                d="M18 2.0845a15.9155 15.9155 0 0 1 0 31.831a15.9155 15.9155 0 0 1 0 -31.831" />
                            <path
                                class="{% if job.match_score > 80 %}text-green-500{% elif job.match_score > 50 %}text-yellow-400{% else %}text-red-500{% endif %}"
                                stroke-width="3" stroke-linecap="round" fill="none"
                                stroke-dasharray="{{ m.match_score }},100"
                                d="M18 2.0845a15.9155 15.9155 0 0 1 0 31.831a15.9155 15.9155 0 0 1 0 -31.831" />
                        </svg>
                        <div class="absolute inset-0 flex items-center justify-center">
                            <span class="text-xs font-medium text-gray-700">{{ m.match_score|floatformat:1 }}%</span>
                        </div>
                    </div>
                </div>

                <div class="mt-3 text-sm text-gray-600">
                    <a href="{% url 'resume_detail' m.resume_id %}" target="_blank" class="flex items-center hover:text-blue-600">
                        <i class="bi bi-file-earmark-text mr-1"></i> {{ m.resume.file.name|slice:'15:' }}
                    </a>
                </div>

                <div class="flex justify-between items-center mt-4">
                    <a href="{{ m.apply_url }}" target="_blank"
                        class="inline-flex items-center text-blue-600 hover:text-blue-800 text-sm font-semibold">
                        <i class="bi bi-box-arrow-up-right mr-1"></i> Apply
                    </a>
                    <a href="{% url 'remove_saved_job' m.job_id m.resume_id %}"
                        class="border border-red-500 text-red-500 rounded-full p-2 hover:bg-red-50"
                        title="Remove from Saved">
                        <i class="bi bi-trash"></i>
                    </a>
                </div>
            </div>
            {% endif %}
            {% endfor %}
        </div>
        {% else %}
        <div class="text-center bg-yellow-50 text-yellow-700 py-4 rounded-xl">
            <i class="bi bi-bookmark mr-2"></i> You havenâ€™t saved any jobs yet.
        </div>
        {% endif %}
    </div>
</div>

<!-- Tailwind Tabs Toggle -->
<script>
    document.querySelectorAll('.tab-btn').forEach(btn => {
        btn.addEventListener('click', () => {
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('text-blue-600', 'border-blue-600', 'border-b-2'));
            btn.classList.add('text-blue-600', 'border-blue-600', 'border-b-2');
            document.querySelectorAll('.tab-content').forEach(tab => tab.classList.add('hidden'));
            document.getElementById(btn.dataset.tab).classList.remove('hidden');
        });
    });
</script>

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css">
{% endblock %}